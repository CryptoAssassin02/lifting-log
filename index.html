<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Iron Log" />
<meta name="theme-color" content="#0a0a0a" />
<meta name="mobile-web-app-capable" content="yes" />
<title>Iron Log</title>
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="icon-192.png" />
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body,#root{height:100%;width:100%;background:#0a0a0a;overflow-x:hidden}
body{font-family:'Barlow',sans-serif;color:#e0e0e0;-webkit-font-smoothing:antialiased}
input{-webkit-appearance:none;appearance:none}
input:focus{outline:none}
button{-webkit-appearance:none;appearance:none}
::-webkit-scrollbar{display:none}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SESSION DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SESSIONS = {
  // â”€â”€ LOWER BODY â”€â”€
  A: {
    id: "A",
    title: "SESSION A",
    subtitle: "QUAD / ANTERIOR-CHAIN DOMINANT",
    group: "LOWER BODY",
    duration: "45â€“55 min",
    phases: [
      {
        name: "PHASE 1 â€” KNEE PREP",
        time: "8â€“10 min",
        exercises: [
          { id: "A-A1", name: "Backward Sled Walk", sets: 3, reps: "30 steps/leg", rest: "â€”", tempo: "Continuous", note: "Light load. Land on balls of feet, upright torso, knees over toes." },
          { id: "A-A2", name: "Wall Tibialis Raises", sets: 3, reps: "20", rest: "30", tempo: "2-0-1-0", note: "Back against wall, feet 12â€“18\" out. Pull toes toward shins without bending knees." },
          { id: "A-A3", name: "BW ATG Split Squat Hold", sets: 2, reps: "20s hold/leg", rest: "30", tempo: "Isometric", note: "Front foot elevated 2â€“3\". Deep split squat, knee well past toes, heel down." },
        ],
      },
      {
        name: "PHASE 2 â€” QUAD HYPERTROPHY",
        time: "20â€“25 min",
        exercises: [
          { id: "A-B1", name: "Heel-Elevated DB Goblet Squat", sets: 3, reps: "10â€“12", rest: "90", tempo: "3-1-1-0", note: "Heels on plates. DB at chest. Deep descent, upright torso." },
          { id: "A-B2", name: "Belt Squat Machine", sets: 3, reps: "10â€“12", rest: "90", tempo: "3-0-1-0", note: "Belt at hips. Zero spinal compression. Full depth, don't lock out at top." },
          { id: "A-C1", name: "DB Reverse Lunge to Knee Drive", sets: 3, reps: "8â€“10/leg", rest: "60", tempo: "2-0-1-1", note: "Step back into lunge, explosively drive knee to hip height, pause 1s at top." },
          { id: "A-D1", name: "Cable Somersault Squat", sets: 3, reps: "10â€“12", rest: "60", tempo: "3-1-1-0", note: "EZ bar behind knees on low cable, stand on plate, DB on quads. Deep squat with constant tension." },
        ],
      },
      {
        name: "PHASE 3 â€” ROTATION & CORE",
        time: "8â€“10 min",
        exercises: [
          { id: "A-E1", name: "Iso Lunge Pallof Press + Rotation", sets: 3, reps: "8â€“10/side", rest: "45", tempo: "2-1-2-1", note: "Split stance, hold moderate lunge. Press out, rotate 30â€“45Â° away from cable, return." },
          { id: "A-E2", name: "Landmine Rot. Squat-to-Press", sets: 3, reps: "8/side", rest: "45", tempo: "Controlled", note: "Bar at shoulder, squat, rotate and press diagonally across body as you stand." },
        ],
      },
      {
        name: "PHASE 4 â€” KNEE HEALTH FINISHER",
        time: "5 min",
        superset: "Superset F1 & F2 Â· 60s rest after pair",
        exercises: [
          { id: "A-F1", name: "Petersen Step-Up", sets: 2, reps: "12â€“15/leg", rest: "â€”", tempo: "2-0-1-0", note: "6â€“8\" step. Rise onto ball of foot extending through knee. Isolates VMO." },
          { id: "A-F2", name: "KOT Calf Raise (bent knee)", sets: 2, reps: "15â€“20", rest: "60", tempo: "2-1-2-0", note: "Knees bent 20â€“30Â°. Rise onto toes, lower heels below step. Targets soleus." },
        ],
      },
    ],
  },
  B: {
    id: "B",
    title: "SESSION B",
    subtitle: "HAMSTRING / POSTERIOR-CHAIN DOMINANT",
    group: "LOWER BODY",
    duration: "45â€“55 min",
    phases: [
      {
        name: "PHASE 1 â€” KNEE PREP",
        time: "8â€“10 min",
        exercises: [
          { id: "B-A1", name: "Backward Sled Walk", sets: 3, reps: "30 steps/leg", rest: "â€”", tempo: "Continuous", note: "Same as Session A. Non-negotiable knee prep." },
          { id: "B-A2", name: "Wall Tibialis Raises", sets: 2, reps: "20", rest: "30", tempo: "2-0-1-0", note: "Same as Session A." },
          { id: "B-A3", name: "Banded Lateral Walk + Hip Hinge", sets: 2, reps: "10 steps/dir", rest: "30", tempo: "Controlled", note: "Mini band above knees. Quarter-squat lateral walk 10 steps, hip hinge 2s hold, walk back." },
        ],
      },
      {
        name: "PHASE 2 â€” POSTERIOR HYPERTROPHY",
        time: "20â€“25 min",
        exercises: [
          { id: "B-B1", name: "DB Staggered-Stance RDL", sets: 3, reps: "8â€“10/leg", rest: "60", tempo: "3-1-1-0", note: "DB in each hand. Back foot toes only, 12\" behind. Hinge to mid-shin. 1s pause at bottom." },
          { id: "B-B2", name: "Leg Curl (Drop Set final)", sets: 3, reps: "10â€“12", rest: "75", tempo: "3-1-1-0", note: "Pad above Achilles. 3s eccentric. Final set: working weight â†’ fail â†’ drop 25â€“30% â†’ fail." },
          { id: "B-C1", name: "KB Goblet Lateral Lunge", sets: 3, reps: "8â€“10/leg", rest: "60", tempo: "2-1-1-0", note: "KB at chest. Large step to side, sit hips back into stepping leg, opposite leg straight." },
          { id: "B-C2", name: "Leg Press (feet high & wide)", sets: 3, reps: "10â€“12", rest: "90", tempo: "3-0-1-0", note: "Feet high on platform, wider than shoulders, toes out 15â€“20Â°. Drive through heels." },
        ],
      },
      {
        name: "PHASE 3 â€” ROTATIONAL POWER",
        time: "8â€“10 min",
        exercises: [
          { id: "B-D1", name: "Cable Low-to-High Rot. Chop", sets: 3, reps: "10â€“12/side", rest: "45", tempo: "Explosive / 2s down", note: "Cable at lowest. Athletic stance perpendicular. Rotate from low hip to above opposite shoulder." },
          { id: "B-D2", name: "SL KB DL to Rotational Row", sets: 3, reps: "8/leg", rest: "45", tempo: "Controlled", note: "Single-leg RDL to parallel, row KB to hip while rotating thoracic spine open." },
        ],
      },
      {
        name: "PHASE 4 â€” CALF FINISHER",
        time: "5â€“7 min",
        superset: "Tri-set E1/E2/E3 Â· 60s rest after trio",
        exercises: [
          { id: "B-E1", name: "DB Walking Lunge (long stride)", sets: 2, reps: "10/leg", rest: "â€”", tempo: "2-0-1-0", note: "Exaggerated stride for glute/ham emphasis. Drive through heel." },
          { id: "B-E2", name: "Standing Calf Raise (straight)", sets: 2, reps: "12â€“15", rest: "â€”", tempo: "2-2-2-0", note: "Knees locked. 2s up, 2s hold peak, 2s down below step." },
          { id: "B-E3", name: "Seated / KOT Calf Raise", sets: 2, reps: "15â€“20", rest: "60", tempo: "2-1-2-0", note: "Bent-knee for soleus isolation." },
        ],
      },
    ],
  },

  // â”€â”€ PUSH â”€â”€
  C: {
    id: "C",
    title: "SESSION C",
    subtitle: "CHEST / LOWER CHEST DOMINANT",
    group: "PUSH",
    duration: "40â€“50 min",
    phases: [
      {
        name: "PHASE 1 â€” SHOULDER ACTIVATION",
        time: "3â€“4 min",
        exercises: [
          { id: "C-C1", name: "Half-Kneeling KB Halo", sets: 2, reps: "8/dir", rest: "30", tempo: "Controlled", note: "KB by horns, circle around head. Torso stays still. Switch kneeling leg halfway." },
        ],
      },
      {
        name: "PHASE 2 â€” CHEST HYPERTROPHY",
        time: "18â€“22 min",
        exercises: [
          { id: "C-C2", name: "Flat Dumbbell Chest Press", sets: 3, reps: "8â€“10", rest: "90", tempo: "3-1-1-0", note: "Palms 15Â° inward. Elbows 45Â° from torso. 3s eccentric, squeeze at top." },
          { id: "C-C3", name: "Standing Cable Decline Press", sets: 3, reps: "10â€“12", rest: "75", tempo: "2-1-2-0", note: "Pulleys at shoulder height. Press forward and down 30â€“45Â°. Squeeze 1s at bottom." },
          { id: "C-C5", name: "Weighted Dip Machine", sets: 3, reps: "8â€“10", rest: "75", tempo: "3-0-1-0", note: "Slight forward lean. Neutral grip. Stop at parallelâ€”no deeper. Don't lock out." },
        ],
      },
      {
        name: "PHASE 3 â€” FUNCTIONAL ROTATION",
        time: "10â€“12 min",
        exercises: [
          { id: "C-C4", name: "HK SA Cable Press w/ Rotation", sets: 3, reps: "8â€“10/side", rest: "60", tempo: "2-1-1-0", note: "Half-kneeling perpendicular to cable. Press across body rotating thoracic spine. Hips stay square." },
          { id: "C-C6", name: "SA KB Floor Press to Glute Bridge", sets: 2, reps: "8/arm", rest: "45", tempo: "2-1-1-1", note: "Bridge hips up, press KB, hold bridge. Anti-rotation core challenge." },
        ],
      },
      {
        name: "PHASE 4 â€” TRICEP ISOLATION",
        time: "5â€“6 min",
        exercises: [
          { id: "C-C7", name: "Overhead Rope Tricep Extension", sets: 3, reps: "12â€“15", rest: "60", tempo: "2-1-2-0", note: "Low cable, face away. Elbows tight by ears. Long head emphasis. Drop set final set." },
        ],
      },
    ],
  },
  D: {
    id: "D",
    title: "SESSION D",
    subtitle: "UPPER CHEST / SHOULDER DOMINANT",
    group: "PUSH",
    duration: "40â€“50 min",
    phases: [
      {
        name: "PHASE 1 â€” SHOULDER STABILIZATION",
        time: "3â€“4 min",
        exercises: [
          { id: "D-D1", name: "Bottoms-Up KB Press (Seated)", sets: 2, reps: "6â€“8/arm", rest: "30", tempo: "2-1-2-0", note: "KB bottom-up, wrist straight. Press overhead keeping forearm vertical. Light weight, quality reps." },
        ],
      },
      {
        name: "PHASE 2 â€” UPPER CHEST & SHOULDER HYPERTROPHY",
        time: "18â€“22 min",
        exercises: [
          { id: "D-D2", name: "Low-Incline DB Press (15â€“20Â°)", sets: 3, reps: "8â€“10", rest: "90", tempo: "3-1-1-0", note: "First notch above flat. Same grip as flat press. 3s eccentric. Upper chest emphasis." },
          { id: "D-D3", name: "Machine Shoulder Press (Neutral)", sets: 3, reps: "8â€“10", rest: "75", tempo: "3-0-1-0", note: "Neutral grip. Back flat. Press to just short of lockout. Lower to ear height." },
          { id: "D-D5", name: "Low-to-High Cable Fly", sets: 3, reps: "12â€“15", rest: "60", tempo: "2-1-2-0", note: "Pulleys at lowest. Sweep up to chin height. Pinkies together at top. Drop set final." },
        ],
      },
      {
        name: "PHASE 3 â€” ROTATIONAL POWER & MOBILITY",
        time: "10â€“12 min",
        exercises: [
          { id: "D-D4", name: "Landmine Press w/ Rotation", sets: 3, reps: "8â€“10/arm", rest: "60", tempo: "Explosive / 2s down", note: "Single arm. Rotate torso away as you press. Pivot rear foot. Hip-core-shoulder chain." },
          { id: "D-D6", name: "HK KB Windmill", sets: 2, reps: "5â€“6/side", rest: "45", tempo: "Controlled", note: "KB overhead, locked arm. Hinge and rotate down. Eyes on bell. Light weight (15â€“25 lbs)." },
        ],
      },
      {
        name: "PHASE 4 â€” TRICEP ISOLATION",
        time: "5â€“6 min",
        exercises: [
          { id: "D-D7", name: "Cross-Body Cable Tricep Ext.", sets: 3, reps: "12â€“15/arm", rest: "45", tempo: "2-1-1-0", note: "Cable at head height, stand sideways. Extend across body. Lateral head emphasis. Rest-pause final." },
        ],
      },
    ],
  },
};

// Session groups for home screen
const SESSION_GROUPS = [
  { label: "LOWER BODY", icon: "ğŸ¦µ", ids: ["A", "B"] },
  { label: "PUSH", icon: "ğŸ’ª", ids: ["C", "D"] },
];

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REST TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function RestTimer({ seconds, onComplete }) {
  const [remaining, setRemaining] = useState(seconds);
  const intervalRef = useRef(null);

  useEffect(() => {
    setRemaining(seconds);
    intervalRef.current = setInterval(() => {
      setRemaining((prev) => {
        if (prev <= 1) {
          clearInterval(intervalRef.current);
          onComplete?.();
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
    return () => clearInterval(intervalRef.current);
  }, [seconds]);

  const pct = ((seconds - remaining) / seconds) * 100;
  const mins = Math.floor(remaining / 60);
  const secs = remaining % 60;

  return (
    <div style={{
      background: "linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)",
      border: "1px solid #D4AF37", borderRadius: 8, padding: "12px 16px", marginTop: 8,
      display: "flex", alignItems: "center", gap: 12,
    }}>
      <div style={{ position: "relative", width: 40, height: 40, flexShrink: 0 }}>
        <svg width="40" height="40" viewBox="0 0 40 40">
          <circle cx="20" cy="20" r="17" fill="none" stroke="#222" strokeWidth="3" />
          <circle cx="20" cy="20" r="17" fill="none" stroke="#D4AF37" strokeWidth="3"
            strokeDasharray={`${(pct / 100) * 106.8} 106.8`}
            strokeLinecap="round" transform="rotate(-90 20 20)"
            style={{ transition: "stroke-dasharray 0.3s ease" }} />
        </svg>
        <div style={{
          position: "absolute", inset: 0, display: "flex", alignItems: "center", justifyContent: "center",
          fontSize: 10, fontWeight: 700, color: remaining === 0 ? "#4CAF50" : "#D4AF37",
          fontFamily: "'JetBrains Mono', monospace",
        }}>{remaining === 0 ? "âœ“" : `${mins}:${secs.toString().padStart(2, "0")}`}</div>
      </div>
      <div style={{ flex: 1 }}>
        <div style={{ height: 4, background: "#222", borderRadius: 2, overflow: "hidden" }}>
          <div style={{
            height: "100%", width: `${pct}%`, borderRadius: 2,
            background: remaining === 0 ? "#4CAF50" : "linear-gradient(90deg, #D4AF37, #F4E076)",
            transition: "width 0.3s ease",
          }} />
        </div>
      </div>
      <button onClick={() => { clearInterval(intervalRef.current); onComplete?.(); }} style={{
        background: "none", border: "1px solid #333", borderRadius: 6, padding: "4px 10px",
        color: "#888", fontSize: 10, fontWeight: 700, fontFamily: "'JetBrains Mono', monospace", cursor: "pointer",
      }}>SKIP</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SET ROW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function SetRow({ setNum, data, onChange, restSeconds }) {
  const [showTimer, setShowTimer] = useState(false);
  const canTime = restSeconds && restSeconds !== "â€”" && !isNaN(parseInt(restSeconds));

  return (
    <div>
      <div style={{
        display: "grid", gridTemplateColumns: "28px 1fr 1fr 32px", gap: 8, alignItems: "center",
        padding: "6px 0",
      }}>
        <div style={{
          width: 28, height: 28, borderRadius: 6, display: "flex", alignItems: "center", justifyContent: "center",
          fontSize: 11, fontWeight: 900, fontFamily: "'JetBrains Mono', monospace",
          background: data.done ? "linear-gradient(135deg, #D4AF37, #F4E076)" : "#1a1a1a",
          color: data.done ? "#0a0a0a" : "#555",
          border: data.done ? "none" : "1px solid #333",
        }}>{setNum}</div>
        <input type="text" inputMode="decimal" placeholder="lbs"
          value={data.weight || ""}
          onChange={e => onChange({ ...data, weight: e.target.value })}
          style={{
            background: "#111", border: "1px solid #2a2a2a", borderRadius: 6, padding: "8px 10px",
            color: "#e0e0e0", fontSize: 14, fontFamily: "'JetBrains Mono', monospace",
            textAlign: "center", width: "100%", boxSizing: "border-box",
          }}
          onFocus={e => e.target.style.borderColor = "#D4AF37"}
          onBlur={e => e.target.style.borderColor = "#2a2a2a"}
        />
        <input type="text" inputMode="text" placeholder="reps"
          value={data.reps || ""}
          onChange={e => onChange({ ...data, reps: e.target.value })}
          style={{
            background: "#111", border: "1px solid #2a2a2a", borderRadius: 6, padding: "8px 10px",
            color: "#e0e0e0", fontSize: 14, fontFamily: "'JetBrains Mono', monospace",
            textAlign: "center", width: "100%", boxSizing: "border-box",
          }}
          onFocus={e => e.target.style.borderColor = "#D4AF37"}
          onBlur={e => e.target.style.borderColor = "#2a2a2a"}
        />
        <button onClick={() => {
          const newDone = !data.done;
          onChange({ ...data, done: newDone });
          if (newDone && canTime) setShowTimer(true);
        }} style={{
          width: 32, height: 32, borderRadius: 6, border: "none", cursor: "pointer",
          background: data.done ? "#D4AF37" : "#1a1a1a", color: data.done ? "#0a0a0a" : "#444",
          fontSize: 16, display: "flex", alignItems: "center", justifyContent: "center",
        }}>âœ“</button>
      </div>
      {showTimer && canTime && (
        <RestTimer seconds={parseInt(restSeconds)} onComplete={() => setShowTimer(false)} />
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXERCISE CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ExerciseCard({ exercise, logData, onUpdateLog }) {
  const [expanded, setExpanded] = useState(false);
  const sets = logData?.sets || Array.from({ length: exercise.sets }, () => ({ weight: "", reps: "", done: false }));
  const completedSets = sets.filter(s => s.done).length;
  const allDone = completedSets === exercise.sets;

  const updateSet = (idx, newData) => {
    const newSets = [...sets];
    newSets[idx] = newData;
    onUpdateLog({ sets: newSets });
  };

  const displayId = exercise.id.split("-").slice(1).join("-");

  return (
    <div style={{
      background: allDone ? "linear-gradient(135deg, #0d1a0d 0%, #111 100%)" : "#111",
      borderRadius: 10, marginBottom: 8, overflow: "hidden",
      border: allDone ? "1px solid #2d4a2d" : "1px solid #1a1a1a",
      transition: "all 0.3s ease",
    }}>
      <div onClick={() => setExpanded(!expanded)} style={{
        padding: "14px 16px", cursor: "pointer", display: "flex", alignItems: "center", gap: 12,
        userSelect: "none",
      }}>
        <div style={{
          minWidth: 36, height: 36, borderRadius: 6, display: "flex", alignItems: "center", justifyContent: "center",
          background: allDone ? "linear-gradient(135deg, #D4AF37, #F4E076)" : "linear-gradient(135deg, #1a1a1a, #222)",
          color: allDone ? "#0a0a0a" : "#D4AF37",
          fontSize: 12, fontWeight: 900, fontFamily: "'JetBrains Mono', monospace",
          border: allDone ? "none" : "1px solid #333", letterSpacing: -0.5,
        }}>{displayId}</div>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{
            color: allDone ? "#D4AF37" : "#e0e0e0", fontSize: 14, fontWeight: 700,
            fontFamily: "'Barlow Condensed', sans-serif", letterSpacing: 0.3,
            whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis",
          }}>{exercise.name}</div>
          <div style={{
            color: "#666", fontSize: 11, fontFamily: "'JetBrains Mono', monospace", marginTop: 2,
          }}>{exercise.sets}Ã—{exercise.reps} Â· {exercise.rest === "â€”" ? "no rest" : exercise.rest + "s"} Â· {exercise.tempo}</div>
        </div>
        <div style={{ display: "flex", alignItems: "center", gap: 6, flexShrink: 0 }}>
          <div style={{
            fontSize: 10, fontWeight: 700, color: allDone ? "#4CAF50" : "#666",
            fontFamily: "'JetBrains Mono', monospace",
          }}>{completedSets}/{exercise.sets}</div>
          <div style={{
            color: "#555", fontSize: 12,
            transform: expanded ? "rotate(180deg)" : "rotate(0deg)",
            transition: "transform 0.2s ease",
          }}>â–¼</div>
        </div>
      </div>

      {expanded && (
        <div style={{ padding: "0 16px 14px" }}>
          {exercise.note && (
            <div style={{
              background: "#0d0d0d", borderRadius: 6, padding: "8px 12px", marginBottom: 10,
              borderLeft: "2px solid #D4AF37",
            }}>
              <div style={{
                color: "#999", fontSize: 12, fontFamily: "'Barlow', sans-serif", lineHeight: 1.4,
              }}>{exercise.note}</div>
            </div>
          )}
          <div style={{
            display: "grid", gridTemplateColumns: "28px 1fr 1fr 32px", gap: 8,
            padding: "0 0 4px", marginBottom: 4,
          }}>
            <div style={{ fontSize: 9, color: "#444", fontFamily: "'JetBrains Mono', monospace", textAlign: "center" }}>SET</div>
            <div style={{ fontSize: 9, color: "#444", fontFamily: "'JetBrains Mono', monospace", textAlign: "center" }}>WEIGHT</div>
            <div style={{ fontSize: 9, color: "#444", fontFamily: "'JetBrains Mono', monospace", textAlign: "center" }}>REPS</div>
            <div style={{ fontSize: 9, color: "#444", fontFamily: "'JetBrains Mono', monospace", textAlign: "center" }}>âœ“</div>
          </div>
          {sets.map((s, i) => (
            <SetRow key={i} setNum={i + 1} data={s}
              onChange={d => updateSet(i, d)} restSeconds={exercise.rest} />
          ))}
        </div>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function App() {
  const [activeSession, setActiveSession] = useState(null);
  const [logs, setLogs] = useState({});
  const [workoutStartTime, setWorkoutStartTime] = useState(null);
  const [elapsed, setElapsed] = useState(0);
  const [history, setHistory] = useState([]);
  const [showHistory, setShowHistory] = useState(false);

  // Load from localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem("ironlog_state");
      if (saved) {
        const state = JSON.parse(saved);
        if (state.logs) setLogs(state.logs);
        if (state.history) setHistory(state.history);
        if (state.activeSession) setActiveSession(state.activeSession);
        if (state.workoutStartTime) setWorkoutStartTime(state.workoutStartTime);
      }
    } catch (e) {}
  }, []);

  // Save to localStorage
  const saveState = useCallback((newLogs, newHistory, newSession, newTimer) => {
    const state = {
      logs: newLogs ?? logs,
      history: newHistory ?? history,
      activeSession: newSession !== undefined ? newSession : activeSession,
      workoutStartTime: newTimer !== undefined ? newTimer : workoutStartTime,
    };
    try { localStorage.setItem("ironlog_state", JSON.stringify(state)); } catch (e) {}
  }, [logs, history, activeSession, workoutStartTime]);

  // Timer tick
  useEffect(() => {
    if (!workoutStartTime) return;
    const tick = setInterval(() => {
      setElapsed(Math.floor((Date.now() - workoutStartTime) / 1000));
    }, 1000);
    return () => clearInterval(tick);
  }, [workoutStartTime]);

  const startSession = (id) => {
    const now = Date.now();
    setActiveSession(id);
    setWorkoutStartTime(now);
    setElapsed(0);
    saveState(logs, history, id, now);
  };

  const updateExerciseLog = (sessionId, exerciseId, data) => {
    const newLogs = { ...logs, [sessionId]: { ...logs[sessionId], [exerciseId]: data } };
    setLogs(newLogs);
    saveState(newLogs, history, activeSession, workoutStartTime);
  };

  const finishWorkout = () => {
    const session = SESSIONS[activeSession];
    let totalSets = 0, completedSets = 0;
    session.phases.forEach(p => p.exercises.forEach(ex => {
      totalSets += ex.sets;
      const exLog = logs[activeSession]?.[ex.id];
      if (exLog?.sets) completedSets += exLog.sets.filter(s => s.done).length;
    }));

    const duration = elapsed;
    const mins = Math.floor(duration / 60);
    const secs = duration % 60;

    const entry = {
      id: generateId(),
      sessionId: activeSession,
      title: session.title,
      subtitle: session.subtitle,
      group: session.group,
      date: new Date().toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" }),
      completedSets,
      totalSets,
      duration: `${mins}m ${secs.toString().padStart(2, "0")}s`,
    };

    const newHistory = [entry, ...history].slice(0, 50);
    const newLogs = { ...logs };
    delete newLogs[activeSession];

    setHistory(newHistory);
    setLogs(newLogs);
    setActiveSession(null);
    setWorkoutStartTime(null);
    setElapsed(0);
    saveState(newLogs, newHistory, null, null);
  };

  // Progress calc
  const session = activeSession ? SESSIONS[activeSession] : null;
  let totalEx = 0, doneEx = 0;
  if (session) {
    session.phases.forEach(p => p.exercises.forEach(ex => {
      totalEx += ex.sets;
      const exLog = logs[activeSession]?.[ex.id];
      if (exLog?.sets) doneEx += exLog.sets.filter(s => s.done).length;
    }));
  }
  const progressPct = totalEx > 0 ? (doneEx / totalEx) * 100 : 0;

  // â•â•â•â•â•â• HOME SCREEN â•â•â•â•â•â•
  if (!activeSession) {
    return (
      <div style={{ minHeight: "100vh", background: "#0a0a0a", display: "flex", flexDirection: "column" }}>
        <div style={{
          padding: "50px 20px 24px", textAlign: "center",
          background: "linear-gradient(180deg, #111 0%, #0a0a0a 100%)",
          borderBottom: "1px solid #1a1a1a",
        }}>
          <div style={{
            fontSize: 11, fontWeight: 800, letterSpacing: 6, color: "#D4AF37",
            fontFamily: "'JetBrains Mono', monospace", marginBottom: 8,
          }}>IRON LOG</div>
          <div style={{
            fontSize: 32, fontWeight: 900, letterSpacing: -1,
            fontFamily: "'Barlow Condensed', sans-serif",
            background: "linear-gradient(135deg, #e0e0e0 0%, #888 100%)",
            WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent",
          }}>TRAINING LOG</div>
          <div style={{
            width: 40, height: 2, background: "linear-gradient(90deg, transparent, #D4AF37, transparent)",
            margin: "12px auto 0",
          }} />
        </div>

        <div style={{ padding: 20, flex: 1 }}>
          {SESSION_GROUPS.map(group => (
            <div key={group.label} style={{ marginBottom: 24 }}>
              <div style={{
                fontSize: 10, fontWeight: 800, letterSpacing: 4, color: "#D4AF37",
                fontFamily: "'JetBrains Mono', monospace", marginBottom: 10,
                display: "flex", alignItems: "center", gap: 8,
              }}>
                <span>{group.icon}</span> {group.label}
              </div>
              {group.ids.map(id => {
                const s = SESSIONS[id];
                const exCount = s.phases.reduce((a, p) => a + p.exercises.length, 0);
                return (
                  <div key={id} onClick={() => startSession(id)} style={{
                    background: "linear-gradient(135deg, #111 0%, #161616 100%)",
                    border: "1px solid #222", borderRadius: 12, padding: 20, marginBottom: 10,
                    cursor: "pointer", position: "relative", overflow: "hidden",
                  }}>
                    <div style={{
                      position: "absolute", top: 12, right: 16, fontSize: 44, fontWeight: 900,
                      fontFamily: "'Barlow Condensed', sans-serif", color: "#1a1a1a", lineHeight: 1,
                    }}>{id}</div>
                    <div style={{
                      fontSize: 10, fontWeight: 800, letterSpacing: 4, color: "#D4AF37",
                      fontFamily: "'JetBrains Mono', monospace", marginBottom: 6,
                    }}>{s.title}</div>
                    <div style={{
                      fontSize: 18, fontWeight: 800, fontFamily: "'Barlow Condensed', sans-serif",
                      color: "#e0e0e0", marginBottom: 4,
                    }}>{s.subtitle}</div>
                    <div style={{
                      fontSize: 11, color: "#666", fontFamily: "'JetBrains Mono', monospace", marginTop: 6,
                    }}>{exCount} exercises Â· {s.duration} Â· {s.phases.length} phases</div>
                    <div style={{ marginTop: 12, display: "flex", alignItems: "center", gap: 8 }}>
                      <div style={{
                        background: "linear-gradient(135deg, #D4AF37, #F4E076)",
                        color: "#0a0a0a", fontSize: 10, fontWeight: 800,
                        fontFamily: "'JetBrains Mono', monospace",
                        padding: "5px 12px", borderRadius: 4, letterSpacing: 1,
                      }}>START â†’</div>
                    </div>
                  </div>
                );
              })}
            </div>
          ))}

          {/* History */}
          {history.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <div onClick={() => setShowHistory(!showHistory)} style={{
                display: "flex", alignItems: "center", justifyContent: "space-between",
                cursor: "pointer", padding: "8px 0", marginBottom: 8,
              }}>
                <div style={{
                  fontSize: 11, fontWeight: 800, letterSpacing: 4, color: "#555",
                  fontFamily: "'JetBrains Mono', monospace",
                }}>HISTORY ({history.length})</div>
                <div style={{
                  color: "#555", fontSize: 12,
                  transform: showHistory ? "rotate(180deg)" : "rotate(0deg)",
                  transition: "transform 0.2s ease",
                }}>â–¼</div>
              </div>
              {showHistory && history.map((h) => (
                <div key={h.id} style={{
                  background: "#111", border: "1px solid #1a1a1a", borderRadius: 8,
                  padding: "12px 14px", marginBottom: 6,
                  display: "flex", alignItems: "center", justifyContent: "space-between",
                }}>
                  <div>
                    <div style={{
                      fontSize: 13, fontWeight: 700, color: "#ccc",
                      fontFamily: "'Barlow Condensed', sans-serif",
                    }}>{h.title} â€” {h.date}</div>
                    <div style={{
                      fontSize: 11, color: "#555", fontFamily: "'JetBrains Mono', monospace", marginTop: 2,
                    }}>{h.completedSets}/{h.totalSets} sets Â· {h.duration}{h.group ? ` Â· ${h.group}` : ""}</div>
                  </div>
                  <div style={{
                    fontSize: 11, fontWeight: 700,
                    color: h.completedSets === h.totalSets ? "#4CAF50" : "#D4AF37",
                    fontFamily: "'JetBrains Mono', monospace",
                  }}>{h.completedSets === h.totalSets ? "COMPLETE" : `${Math.round((h.completedSets / h.totalSets) * 100)}%`}</div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  }

  // â•â•â•â•â•â• ACTIVE WORKOUT â•â•â•â•â•â•
  const elMins = Math.floor(elapsed / 60);
  const elSecs = elapsed % 60;

  return (
    <div style={{ minHeight: "100vh", background: "#0a0a0a", paddingBottom: 80 }}>
      {/* Sticky header */}
      <div style={{
        position: "sticky", top: 0, zIndex: 200,
        background: "linear-gradient(180deg, #0a0a0a 80%, rgba(10,10,10,0.95) 100%)",
        padding: "12px 16px 8px",
        borderBottom: "1px solid #1a1a1a",
      }}>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 8 }}>
          <button onClick={() => { setActiveSession(null); setWorkoutStartTime(null); saveState(logs, history, null, null); }} style={{
            background: "none", border: "1px solid #333", borderRadius: 6, padding: "4px 10px",
            color: "#888", fontSize: 10, fontWeight: 700, fontFamily: "'JetBrains Mono', monospace", cursor: "pointer",
          }}>â† BACK</button>
          <div style={{
            fontSize: 10, fontWeight: 800, letterSpacing: 4, color: "#D4AF37",
            fontFamily: "'JetBrains Mono', monospace",
          }}>{session.title}</div>
          <div style={{
            fontSize: 12, fontWeight: 700, color: "#e0e0e0",
            fontFamily: "'JetBrains Mono', monospace",
          }}>{elMins}:{elSecs.toString().padStart(2, "0")}</div>
        </div>
        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
          <div style={{ flex: 1, height: 4, background: "#1a1a1a", borderRadius: 2, overflow: "hidden" }}>
            <div style={{
              height: "100%", width: `${progressPct}%`, borderRadius: 2,
              background: progressPct >= 100 ? "#4CAF50" : "linear-gradient(90deg, #D4AF37, #F4E076)",
              transition: "width 0.5s ease",
            }} />
          </div>
          <div style={{
            fontSize: 10, fontWeight: 700, color: progressPct >= 100 ? "#4CAF50" : "#D4AF37",
            fontFamily: "'JetBrains Mono', monospace", minWidth: 36, textAlign: "right",
          }}>{Math.round(progressPct)}%</div>
        </div>
        <div style={{
          fontSize: 11, color: "#666", fontFamily: "'Barlow Condensed', sans-serif",
          marginTop: 4, letterSpacing: 0.5,
        }}>{session.subtitle} Â· {session.group}</div>
      </div>

      {/* Phases */}
      <div style={{ padding: "12px 16px" }}>
        {session.phases.map((phase, pi) => (
          <div key={pi} style={{ marginBottom: 20 }}>
            <div style={{
              fontSize: 12, fontWeight: 800, letterSpacing: 2, color: "#D4AF37",
              fontFamily: "'JetBrains Mono', monospace", marginBottom: 4,
            }}>{phase.name}</div>
            <div style={{
              fontSize: 11, color: "#555", fontFamily: "'JetBrains Mono', monospace", marginBottom: 10,
            }}>{phase.time}{phase.superset ? ` Â· ${phase.superset}` : ""}</div>
            {phase.exercises.map(ex => (
              <ExerciseCard key={`${activeSession}-${ex.id}`} exercise={ex}
                logData={logs[activeSession]?.[ex.id]}
                onUpdateLog={data => updateExerciseLog(activeSession, ex.id, data)}
              />
            ))}
          </div>
        ))}
      </div>

      {/* Finish button */}
      <div style={{
        position: "fixed", bottom: 0, left: 0, right: 0,
        padding: "12px 16px", paddingBottom: "max(24px, env(safe-area-inset-bottom))",
        background: "linear-gradient(180deg, rgba(10,10,10,0) 0%, #0a0a0a 30%)", zIndex: 100,
      }}>
        <button onClick={finishWorkout} style={{
          width: "100%", padding: "14px 0", borderRadius: 8, border: "none",
          background: progressPct >= 100
            ? "linear-gradient(135deg, #4CAF50, #66BB6A)"
            : "linear-gradient(135deg, #D4AF37, #F4E076)",
          color: "#0a0a0a", fontSize: 14, fontWeight: 900,
          fontFamily: "'Barlow Condensed', sans-serif", letterSpacing: 2, cursor: "pointer",
          boxShadow: "0 -4px 20px rgba(212, 175, 55, 0.2)",
        }}>{progressPct >= 100 ? "WORKOUT COMPLETE âœ“" : "FINISH WORKOUT"}</button>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>
</body>
</html>
